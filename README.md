[![Ansible CI Pipeline](https://github.com/dmplastun/ansible-docker-lab/actions/workflows/ansible-ci.yml/badge.svg)](https://github.com/dmplastun/ansible-docker-lab/actions/workflows/ansible-ci.yml)

# üõ†Ô∏è Ansible + Docker –õ–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω—ã–π –ü—Ä–æ–µ–∫—Ç

–≠—Ç–æ—Ç —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π —Å–æ–¥–µ—Ä–∂–∏—Ç –ø—Ä–∏–º–µ—Ä –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–µ—Ä–≤–µ—Ä–æ–≤ —á–µ—Ä–µ–∑ **Ansible** —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º **Docker-–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤** –∫–∞–∫ —É–ø—Ä–∞–≤–ª—è–µ–º—ã—Ö —Ö–æ—Å—Ç–æ–≤.

## üéØ –¶–µ–ª—å –ø—Ä–æ–µ–∫—Ç–∞

–ù–∞—É—á–∏—Ç—å—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Ansible –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏:
- –£—Å—Ç–∞–Ω–æ–≤–∫–∏ –ü–û
- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏—è cron-–∑–∞–¥–∞–Ω–∏—è–º–∏
–Ω–∞ 9 Ubuntu-—Å–µ—Ä–≤–µ—Ä–∞—Ö, —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç—ã—Ö –≤ Docker.

---

## üì¶ –ß—Ç–æ –≤–∫–ª—é—á–∞–µ—Ç –ø—Ä–æ–µ–∫—Ç

- `Dockerfile` ‚Äî –æ–±—Ä–∞–∑ Ubuntu —Å SSH/Nginx/cron
- `hosts.yml` ‚Äî —Ñ–∞–π–ª –∏–Ω–≤–µ–Ω—Ç–∞—Ä–∏–∑–∞—Ü–∏–∏ –¥–ª—è Ansible
- `ansible.cfg` ‚Äî –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Ansible
- `Makefile` ‚Äî —É–¥–æ–±–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã –¥–ª—è –∑–∞–ø—É—Å–∫–∞ –ø–ª–µ–π–±—É–∫–æ–≤
- `playbooks/` ‚Äî –∫–∞—Ç–∞–ª–æ–≥ —Å –ø–ª–µ–π–±—É–∫–∞–º–∏:
  - `deploy-nginx.yml` ‚Äî —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ Nginx —á–µ—Ä–µ–∑ —Ä–æ–ª—å
- `roles/` ‚Äî —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ä–æ–ª–µ–π Ansible (–Ω–∞–ø—Ä–∏–º–µ—Ä, `nginx`)
- `README.md` ‚Äî –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø—Ä–æ–µ–∫—Ç–∞

---

## üöÄ –ö–∞–∫ –∑–∞–ø—É—Å—Ç–∏—Ç—å –ø—Ä–æ–µ–∫—Ç

### 1. –°–±–æ—Ä–∫–∞ –æ–±—Ä–∞–∑–∞ Docker

```bash
docker build -t ubuntu-sshd .
```

### 2. –ó–∞–ø—É—Å–∫ 9 –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
```
for i in {1..9}; do
  docker run -d --name server$i -p 22$i:22 -p 80$i:80 ubuntu-sshd
done
```
### 3. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ SSH-–¥–æ—Å—Ç—É–ø–∞
```
ssh-keygen -t rsa -b 4096
for i in {1..9}; do
  ssh-copy-id -i ~/.ssh/id_rsa.pub root@localhost -p 22$i
done
```
#### –ï—Å–ª–∏ –≤–æ–∑–Ω–∏–∫–∞—é—Ç –æ—à–∏–±–∫–∏ –ø—Ä–æ–≤–µ—Ä–∫–∏ –∫–ª—é—á–µ–π
```
for i in {1..9}; do
  ssh-keygen -R '[localhost]:22'$i
done
```
### 4. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —á–µ—Ä–µ–∑ Ansible
```
make ping
```
### üìù –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã –∏–∑ Makefile
```
make ping            #–ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –≤—Å–µ—Ö —Ö–æ—Å—Ç–æ–≤
make deploy-nginx    #–†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ Nginx —á–µ—Ä–µ–∑ —Ä–æ–ª—å
make check-syntax    #–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å–∞ –ø–ª–µ–π–±—É–∫–æ–≤
make help            #–°–ø–∏—Å–æ–∫ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –∫–æ–º–∞–Ω–¥
```
### üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
    –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è SSH-–∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –ø–æ –∫–ª—é—á–∞–º
    –ü–∞—Ä–æ–ª—å root –∑–∞–¥–∞–Ω –∫–∞–∫ password (—Ç–æ–ª—å–∫–æ –¥–ª—è —Ç–µ—Å—Ç–æ–≤–æ–π —Å—Ä–µ–¥—ã)
    –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å ansible-vault –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–µ–∫—Ä–µ—Ç–∞–º–∏ –≤ production
### üìå –ê–≤—Ç–æ—Ä
```
üë§ dmplastun
üìß dmitrij.plastun@gmail.com
üîó https://github.com/dmplastun/ansible-docker-lab/
```
